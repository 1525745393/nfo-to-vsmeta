VSmeta 元数据生成工具 v1.5 说明文档（支持群晖）

==============================================
一、运行方式说明
==============================================

推荐运行命令：
    python3 main.py --config config.json

若放置于可执行脚本中（如 run.sh），内容如下：
    #!/bin/bash
    /usr/local/bin/python3 main.py --config config.json

也可直接双击执行（需系统支持 .py 文件双击）

群晖运行方式（两种方式）：
1. 终端方式（推荐）：
    - 通过 DSM 控制面板安装 Python3（或使用套件中心）
    - 启动 SSH 或使用 Synology Terminal & SNMP 插件连接终端
    - 执行命令：
        cd /volume2/你的脚本路径
        /usr/local/bin/python3 main.py --config config.json

2. 任务计划方式（适合定时）：
    - 打开 DSM → 控制面板 → 任务计划
    - 创建计划任务，用户选择 root
    - 在“任务设置”中填入如下：
        cd /volume2/你的脚本路径 && /usr/local/bin/python3 main.py --config config.json
    - 设置执行周期后保存

注意：
    - 若 Python 路径非 /usr/local/bin/python3，可手动修改 config.json 中的 python_path 字段

==============================================
二、配置文件 config.json 字段说明
==============================================

以下为推荐配置及说明，建议根据实际路径进行调整：

{
  "scan_root": "./JAV_output",  # 要扫描的视频目录，建议填写绝对路径 # 示例："./JAV_output"
  "output_vsmeta_dir": "",  # 输出 .vsmeta 保存路径，空为视频同目录 # 推荐设置缓存目录如："./vsmeta_output"
  "thread_count": 4,  # 并发线程数，建议值 4~8 # 高性能机器可设为 8+
  "skip_existing": true,  # 跳过已存在 .vsmeta 文件 # 改为 false 可覆盖旧文件
  "rename_video": false,  # 是否启用视频重命名功能 # 改为 true 启用重命名
  "rename_keep_original": true,  # 是否保留原视频文件作为备份 # false 则不保留
  "rename_skip_well_named": true,  # 跳过已重命名规范的视频文件 # false 将重新命名全部视频
  "log_dir": "./logs",  # 日志输出路径 # 建议设置单独文件夹
  "nfo_dir": "",  # 预留：nfo 转换输入路径 # 暂未启用，可忽略
  "python_path": ""  # 留空自动查找 Python 路径 # 若自动失败可填写如 "/usr/local/bin/python3"
}

建议：字段后注释已有推荐设置与更改后果。可直接复制配置进行修改。

==============================================
三、主要功能说明
==============================================

- 支持自定义扫描路径和输出路径
- 多线程并发处理，大幅提升处理效率
- 自动跳过已生成 .vsmeta 文件
- 视频文件重命名功能（可选启用）
- 支持按番号或标题重命名，并保留原视频（可配置）
- 群晖专用优化：自动识别 Python 路径，兼容计划任务与终端执行
- 日志记录详细处理情况，保存在 logs 目录中
- 自动补全缺失配置字段并提示警告

==============================================
四、更新日志（changelog）
==============================================

[v1.5 更新内容]
- 新增：config.json 自动补全缺失字段，并提示警告
- 新增：Python 路径自动识别功能，兼容群晖 DSM 系统
- 新增：视频重命名功能（可选，默认关闭）
- 新增：是否保留原文件名、是否跳过已命名视频的可选项
- 新增：输出 .vsmeta 可单独配置路径，支持缓存盘输出
- 优化：日志输出结构与目录组织，支持后续分析

==============================================
五、文件结构建议
==============================================

├── main.py
├── config.json
├── logs/
├── vsmeta_output/ （若配置）
└── JAV_output/（视频文件目录）

建议统一放在 NAS 下的一个脚本目录，便于管理与自动化调用。



VSmeta 元数据生成工具 v1.5 更新日志
====================================

【新增功能】
-------------
1. 支持可选的视频重命名功能（rename_video）
   - 可保留原始文件（rename_keep_original）
   - 可跳过已规范命名的文件（rename_skip_well_named）

2. 自动识别 Python 路径（兼容群晖 DSM 系统）
   - 支持自动查找常见路径（如 /usr/local/bin/python3）
   - 可手动指定 python_path

3. 支持将 .vsmeta 输出至指定目录（output_vsmeta_dir）
   - 可集中存储元数据，便于 Emby/Jellyfin 接入

【优化改进】
-------------
1. 所有 config.json 配置项添加详细操作注释（# 建议 + 更改后果）
   - 支持一键复制、易于理解与修改

2. 日志系统优化
   - 每次执行生成时间戳日志文件
   - 输出成功、失败、统计信息

3. 完善多线程配置说明
   - 默认线程数为 4，可按 NAS 性能调整

【开发中功能（预告）】
----------------------
1. 多视频格式支持：将新增对 .mov、.wmv 等格式识别
2. 自定义重命名模板（如：{title}_{id}.mp4）
3. Dry-run 模拟运行模式
4. JSON 格式日志输出（便于日志分析与集成）
5. 配置文件字段合法性验证（schema 校验）
6. GUI 和 Web UI 计划版本：v2.0+

【配置示例】
-------------
- 配置文件路径默认：`config.json`
- 支持的主键字段：
  - scan_root
  - output_vsmeta_dir
  - rename_video
  - thread_count
  - skip_existing
  - log_dir
  - python_path 等

【兼容性建议】
----------------
- 群晖 DSM：建议使用 Python 3.9+，已适配 /usr/local/bin/python3 路径
- Emby/Jellyfin：建议启用独立 vsmeta 输出目录，避免与原文件混杂

文档更新时间：2025-05-06

## v1.5

- 新增功能：影片文件自动重命名（可选）
  - 支持按标题或番号规则自动重命名视频文件，便于媒体整理
  - 可选项：是否保留原文件名作为备份
  - 可选项：是否跳过已命名规范的文件
  - 关联文件（字幕、封面等）支持独立规则重命名
  - 可通过 config.json 配置开启，默认关闭

- 新增功能：读取 config.json 时进行参数校验与自动补全
  - 若配置缺失则自动填入默认值并输出警告提示
  - 所有参数支持详细注释，说明建议和修改后果
  - 可复制修改项已在注释中明确标记，便于调整

- 新增功能：支持 .vsmeta 输出到自定义目录
  - 用于将元数据与视频分离，例如输出至 NAS 缓存盘
  - config.json 中可设置输出路径，支持相对与绝对路径

- 群晖优化：
  - 自动兼容常见 DSM 的 Python 路径（如 /usr/local/bin/python3）
  - 可在 config.json 手动指定 Python 路径，增强适配性

- 日志功能增强：
  - 每次执行生成独立的时间戳命名日志文件
  - 支持统计总处理数、成功数、失败数
  - 每个视频处理失败时记录详细失败原因
  - 最终输出日志摘要报告

- 命令行参数增强：
  - --only-missing：仅处理缺失的 .vsmeta 文件
  - --overwrite：控制是否覆盖已有的 .vsmeta 文件（默认不覆盖）
  - --root：支持多个目录输入
  - --root-file：支持从文件读取扫描路径列表

- 配置说明增强：
  - 所有 config.json 配置项统一添加详细操作注释
  - 每项注释包含“推荐值、修改方法及后果说明”
  - 所有可更改项后附“可复制切换代码”，提高修改效率
VSmeta 视频元数据生成工具 v1.6

【简介】
用于将已有 .nfo 元数据转为 Synology Video Station 使用的 .vsmeta 格式，支持多格式视频，重命名、日志生成、干预选项等。

【运行方式】
python3 vsmeta_main_v1.6.py --config config.json

【功能亮点】
- 支持多线程批处理
- 可选重命名规则及保留副本
- 可自定义输出目录（适配 NAS 缓存盘）
- 支持 dry-run 预演模式
- 群晖兼容优化：自动检测 Python 路径
- JSON 日志结构便于集成

【推荐环境】
- Python 3.8+
- 群晖 DSM 7+
- 推荐与 Emby/Jellyfin 搭配

【目录结构】
- scripts/：主程序
- docs/：说明与 changelog
- config.json：参数配置
- logs/：执行日志目录

更多问题请联系作者或社区支持。